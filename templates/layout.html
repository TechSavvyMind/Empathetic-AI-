<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tata Teleservices</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">Tata Teleservices<span> | Next-Gen Telecom</span></div>
        <div class="nav-links">
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('services') }}">Services</a>
            <a href="#">Support</a>
            {% if session.get('user_id') %}
            <a href="{{ url_for('logout') }}" class="btn-primary">Logout</a>
            {% else %}
            <a href="{{ url_for('login') }}" class="btn-primary">Login / Register</a>
            {% endif %}
        </div>
    </nav>

    <!-- Flash Messages -->
    <div class="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert {{ category }}">{{ message }}</div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>

    <!-- Content Block -->
    {% block content %}{% endblock %}

    <!-- Chatbot Widget (Always visible, behavior managed by JS based on login status) -->
    <div class="chat-widget">

        <!-- Pop-up Message (Always visible) -->
        <div class="chat-notification-popup" id="chatPopup">
            Hey there {{ session.get('username', 'Guest') }}, I'm here to assist you with any doubts you might have.
        </div>

        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-robot"></i>
                    <div>
                        <h4>Tata Teleservices Assistant</h4>
                        <!-- Display username only if logged in -->
                        <small>Online | <span id="username-display">
                                {% if session.get('user_id') %}
                                {{ session.username }}
                                {% else %}
                                Guest
                                {% endif %}
                            </span></small>
                    </div>
                </div>
                <!-- Feature 1: Maximize/Minimize Controls -->
                <div class="header-controls">
                    <!-- Icon will change in JS, fa-expand is the default/minimized state -->
                    <i class="fas fa-expand" id="maximizeBtn" onclick="toggleMaximize(event)"
                        title="Maximize"></i>
                    <i class="fas fa-times" onclick="toggleChat()" title="Close"></i>
                </div>
            </div>

            <div class="chat-body" id="chatBody">
                <!-- FAQs will be shown here for logged-in users only -->
                <div class="faq-container" id="faqContainer">
                    <p class="faq-label">Frequent Questions:</p>
                    <button class="faq-btn"
                        onclick="sendFAQ('Check Balance', 'Your current balance is $45.00. Due date: Dec 15, 2025.')">Check
                        Balance</button>
                    <button class="faq-btn"
                        onclick="sendFAQ('Internet Issues', 'Please try restarting your router. If the issue persists, click \'Technical Support\' in your dashboard.')">Internet
                        Issues</button>
                    <button class="faq-btn"
                        onclick="sendFAQ('Upgrade Plan', 'You are currently on the 50GB plan. You can upgrade to Unlimited for just $10/mo more.')">Upgrade
                        Plan</button>
                </div>
            </div>

            <div class="chat-input">
                <input type="text" id="userInput" placeholder="Type a message...">
                <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <!-- Toggle Button with Notification Dot -->
        <div class="chat-toggle" onclick="toggleChat()">
            <i class="fas fa-comment-dots"></i>
            <span class="notification-badge">1</span>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Pass session username and login status to JS safely
        const isLoggedIn = {{ 'true' if session.get('user_id') else 'false' }};
        const currentUser = "{{ session.get('username', 'Guest') }}";
    </script>
</body>

</html>